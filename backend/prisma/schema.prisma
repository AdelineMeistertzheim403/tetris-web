datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "debian-openssl-1.1.x"]
}

model User {
  id        Int      @id @default(autoincrement())
  pseudo    String   @unique
  email     String   @unique
  password  String
  scores    Score[]
  versusAsPlayer1 VersusMatch[] @relation("VersusPlayer1")
  versusAsPlayer2 VersusMatch[] @relation("VersusPlayer2")
  versusAsWinner  VersusMatch[] @relation("VersusWinner")
   roguelikeRuns RoguelikeRun[]
  createdAt DateTime @default(now())
}

model Score {
  id        Int      @id @default(autoincrement())
  value     Int
  level     Int
  lines     Int
  user      User     @relation(fields: [userId], references: [id])
  userId    Int
  createdAt DateTime @default(now())
  mode      GameMode @default(CLASSIQUE)
}

model VersusMatch {
  id             Int      @id @default(autoincrement())
  matchId        String?
  player1Id      Int?
  player1Pseudo  String
  player1Score   Int
  player1Lines   Int
  player2Id      Int?
  player2Pseudo  String
  player2Score   Int
  player2Lines   Int
  winnerId       Int?
  winnerPseudo   String?
  createdAt      DateTime @default(now())

  player1 User? @relation("VersusPlayer1", fields: [player1Id], references: [id])
  player2 User? @relation("VersusPlayer2", fields: [player2Id], references: [id])
  winner  User? @relation("VersusWinner", fields: [winnerId], references: [id])
}

model RoguelikeRun {
  id                Int      @id @default(autoincrement())
  userId            Int

  seed              String
  state             Json
  
  score             Int
  lines             Int
  level             Int

  perks             Json     // tableau dâ€™ids de perks
  bombs             Int
  timeFreezeCharges Int
  chaosMode         Boolean

  gravityMultiplier Float
  scoreMultiplier   Float

  status            RunStatus
  createdAt         DateTime @default(now())
  endedAt           DateTime?

  user              User     @relation(fields: [userId], references: [id])
}

enum RunStatus {
  IN_PROGRESS
  FINISHED
  ABANDONED
}

enum GameMode {
  CLASSIQUE
  SPRINT
  VERSUS
}
